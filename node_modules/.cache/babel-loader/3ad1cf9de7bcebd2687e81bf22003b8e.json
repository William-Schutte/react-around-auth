{"ast":null,"code":"var _jsxFileName = \"/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js\";\nimport React from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip';\nimport * as auth from '../utils/auth.js';\n\nclass App extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      isLoggedIn: null,\n      userEmail: '',\n      currentUser: {},\n      isEditProfileOpen: false,\n      isAddPlaceOpen: false,\n      isEditAvatarOpen: false,\n      isInfoToolTipOpen: false,\n      regSuccess: false,\n      selectedCard: null,\n      cards: []\n    };\n    this.handleEditAvatarClick = this.handleEditAvatarClick.bind(this);\n    this.handleEditProfileClick = this.handleEditProfileClick.bind(this);\n    this.handleAddPlaceClick = this.handleAddPlaceClick.bind(this);\n    this.handleAuthRegClick = this.handleAuthRegClick.bind(this);\n    this.closeAllPopups = this.closeAllPopups.bind(this);\n    this.handleCardClick = this.handleCardClick.bind(this);\n    this.handleUpdateUser = this.handleUpdateUser.bind(this);\n    this.handleUpdateAvatar = this.handleUpdateAvatar.bind(this);\n    this.handleCardLike = this.handleCardLike.bind(this);\n    this.handleCardDelete = this.handleCardDelete.bind(this);\n    this.handleAddPlace = this.handleAddPlace.bind(this);\n    this.handleSetLoggedIn = this.handleSetLoggedIn.bind(this);\n  }\n\n  componentDidMount() {\n    // Get user info for profile section\n    api.getUserInfo().then(res => {\n      this.setState({\n        currentUser: res\n      });\n    }).catch(err => {\n      console.log(err);\n    }); // Get initial cards\n\n    api.getInitialCards().then(res => {\n      this.setState({\n        cards: res\n      });\n    }).catch(err => {\n      console.log(err);\n    }); // Check if user has jwt token\n\n    const jwt = localStorage.getItem('jwt');\n\n    if (jwt) {\n      auth.getUser(jwt).then(res => {\n        console.log(res);\n\n        if (res) {\n          this.setState({\n            isLoggedIn: true\n          });\n        }\n      }).then(() => {\n        this.props.history.push('/');\n        ;\n      });\n    }\n  }\n\n  handleSetLoggedIn(newLoggedInState) {\n    this.setState({\n      isLoggedIn: newLoggedInState\n    });\n  }\n\n  handleEditAvatarClick() {\n    this.setState({\n      isEditAvatarOpen: true\n    });\n  }\n\n  handleEditProfileClick() {\n    this.setState({\n      isEditProfileOpen: true\n    });\n  }\n\n  handleAddPlaceClick() {\n    this.setState({\n      isAddPlaceOpen: true\n    });\n  }\n\n  handleAuthRegClick(result) {\n    this.setState({\n      regSuccess: result,\n      isInfoToolTipOpen: true\n    });\n  }\n\n  closeAllPopups() {\n    this.setState({\n      isEditAvatarOpen: false,\n      isEditProfileOpen: false,\n      isAddPlaceOpen: false,\n      isInfoToolTipOpen: false,\n      selectedCard: null\n    });\n  }\n\n  handleCardClick(card) {\n    this.setState({\n      selectedCard: card\n    });\n  }\n\n  handleUpdateUser(newInfo) {\n    api.patchUserInfo(newInfo).then(res => {\n      this.setState({\n        currentUser: res\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleUpdateAvatar(avatar) {\n    api.patchUserPic(avatar).then(res => {\n      this.setState({\n        currentUser: res\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n    api.likeCard(card, isLiked).then(res => {\n      const newCards = this.state.cards.map(c => c._id === card._id ? res : c);\n      this.setState({\n        cards: newCards\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleCardDelete(card) {\n    api.deleteCard(card._id).then(() => {\n      const newCards = this.state.cards.filter(c => c._id !== card._id);\n      this.setState({\n        cards: newCards\n      });\n    });\n  }\n\n  handleAddPlace(card) {\n    api.addNewCard(card).then(res => {\n      const newCards = [...this.state.cards, res];\n      this.setState({\n        cards: newCards\n      });\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n      value: this.state.currentUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(ProtectedRoute, {\n      exact: true,\n      path: \"/\",\n      component: Main,\n      loggedIn: this.state.isLoggedIn,\n      userEmail: this.state.userEmail,\n      onEditProfile: this.handleEditProfileClick,\n      onAddPlace: this.handleAddPlaceClick,\n      onEditAvatar: this.handleEditAvatarClick,\n      onCardClick: this.handleCardClick,\n      onClose: this.closeAllPopups,\n      cards: this.state.cards,\n      onCardLike: this.handleCardLike,\n      onCardDelete: this.handleCardDelete,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/signup\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Register, {\n      onClick: this.handleAuthRegClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(Route, {\n      path: \"/signin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Login, {\n      onClick: this.handleAuthRegClick,\n      setLoggedIn: this.handleSetLoggedIn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(Route, {\n      path: \"*\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Redirect, {\n      to: \"/signin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 25\n      }\n    }))), /*#__PURE__*/React.createElement(InfoToolTip, {\n      isOpen: this.state.isInfoToolTipOpen,\n      success: this.state.regSuccess,\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(EditProfilePopup, {\n      isOpen: this.state.isEditProfileOpen,\n      onClose: this.closeAllPopups,\n      onUpdateUser: this.handleUpdateUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(EditAvatarPopup, {\n      isOpen: this.state.isEditAvatarOpen,\n      onClose: this.closeAllPopups,\n      onUpdateAvatar: this.handleUpdateAvatar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(AddPlacePopup, {\n      isOpen: this.state.isAddPlaceOpen,\n      onClose: this.closeAllPopups,\n      onAddPlace: this.handleAddPlace,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(PopupWithForm, {\n      name: \"form-delete\",\n      title: \"Are you sure?\",\n      isOpen: null,\n      btnText: \"Yes\",\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(ImagePopup, {\n      card: this.state.selectedCard,\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}\n\nexport default withRouter(App);","map":{"version":3,"sources":["/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","withRouter","Main","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","Register","Login","InfoToolTip","auth","App","Component","constructor","state","isLoggedIn","userEmail","currentUser","isEditProfileOpen","isAddPlaceOpen","isEditAvatarOpen","isInfoToolTipOpen","regSuccess","selectedCard","cards","handleEditAvatarClick","bind","handleEditProfileClick","handleAddPlaceClick","handleAuthRegClick","closeAllPopups","handleCardClick","handleUpdateUser","handleUpdateAvatar","handleCardLike","handleCardDelete","handleAddPlace","handleSetLoggedIn","componentDidMount","getUserInfo","then","res","setState","catch","err","console","log","getInitialCards","jwt","localStorage","getItem","getUser","props","history","push","newLoggedInState","result","card","newInfo","patchUserInfo","avatar","patchUserPic","isLiked","likes","some","i","_id","likeCard","newCards","map","c","deleteCard","filter","addNewCard","render"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip'\nimport * as auth from '../utils/auth.js';\n\nclass App extends React.Component {\n    constructor() {\n        super();\n        this.state={\n            isLoggedIn: null,\n            userEmail: '',\n            currentUser: {},\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isEditAvatarOpen: false,\n            isInfoToolTipOpen: false,\n            regSuccess: false,\n            selectedCard: null,\n            cards: [],\n        };\n        this.handleEditAvatarClick = this.handleEditAvatarClick.bind(this);\n        this.handleEditProfileClick = this.handleEditProfileClick.bind(this);\n        this.handleAddPlaceClick = this.handleAddPlaceClick.bind(this);\n        this.handleAuthRegClick = this.handleAuthRegClick.bind(this);\n        this.closeAllPopups = this.closeAllPopups.bind(this);\n        this.handleCardClick = this.handleCardClick.bind(this);\n        this.handleUpdateUser = this.handleUpdateUser.bind(this);\n        this.handleUpdateAvatar = this.handleUpdateAvatar.bind(this);\n        this.handleCardLike = this.handleCardLike.bind(this);\n        this.handleCardDelete = this.handleCardDelete.bind(this);\n        this.handleAddPlace= this.handleAddPlace.bind(this);\n        this.handleSetLoggedIn = this.handleSetLoggedIn.bind(this);\n    }\n\n    componentDidMount() {\n        // Get user info for profile section\n        api.getUserInfo().then((res) => { \n            this.setState({ currentUser: res}); \n        }).catch((err) => { \n            console.log(err) \n        });\n        \n        // Get initial cards\n        api.getInitialCards().then((res) => { \n            this.setState({ cards: res}); \n        }).catch((err) => { \n            console.log(err) \n        });\n\n        // Check if user has jwt token\n        const jwt = localStorage.getItem('jwt');\n        if (jwt) {\n            auth.getUser(jwt).then((res) => {\n                console.log(res)\n                if (res) {\n                    this.setState({ isLoggedIn: true });\n                }\n            }).then(() => {\n                this.props.history.push('/'); ;\n            });\n        }   \n    }\n\n    handleSetLoggedIn(newLoggedInState) {\n        this.setState({\n            isLoggedIn: newLoggedInState\n        })\n    }\n\n    handleEditAvatarClick() {\n        this.setState({ isEditAvatarOpen: true });\n    }\n\n    handleEditProfileClick() {\n        this.setState({ isEditProfileOpen: true });\n    }\n\n    handleAddPlaceClick() {\n        this.setState({ isAddPlaceOpen: true });\n    }\n\n    handleAuthRegClick(result) {\n        this.setState({\n            regSuccess: result,\n            isInfoToolTipOpen: true\n        });\n    }\n\n    closeAllPopups() {\n        this.setState({\n            isEditAvatarOpen: false,\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isInfoToolTipOpen: false,\n            selectedCard: null\n        });\n    }\n\n    handleCardClick(card) {\n        this.setState({ selectedCard: card });\n    }\n\n    handleUpdateUser(newInfo) {\n        api.patchUserInfo(newInfo)\n            .then((res) => { this.setState({ currentUser: res })})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleUpdateAvatar(avatar) {\n        api.patchUserPic(avatar)\n            .then((res) => { this.setState({ currentUser: res })})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n        api.likeCard(card, isLiked)\n            .then((res) => {\n                const newCards = this.state.cards.map((c) => c._id === card._id ? res : c);\n                this.setState({ cards: newCards });\n            })\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(() => {\n                const newCards = this.state.cards.filter((c) => c._id !== card._id);\n                this.setState({ cards: newCards });\n            });\n    }\n\n    handleAddPlace(card) {\n        api.addNewCard(card)\n            .then((res) => {\n                const newCards = [...this.state.cards, res];\n                this.setState({ cards: newCards });\n            });\n    }\n\n    render() {\n        return (\n            <CurrentUserContext.Provider value={this.state.currentUser}>\n                <Switch>\n                    <ProtectedRoute exact path=\"/\" component={Main} loggedIn={this.state.isLoggedIn} userEmail={this.state.userEmail} onEditProfile={this.handleEditProfileClick} onAddPlace={this.handleAddPlaceClick} onEditAvatar={this.handleEditAvatarClick}\n                        onCardClick={this.handleCardClick} onClose={this.closeAllPopups} cards={this.state.cards} onCardLike={this.handleCardLike} onCardDelete={this.handleCardDelete} />\n                    <Route path='/signup'>\n                        <Register onClick={this.handleAuthRegClick} />\n                    </Route>\n                    <Route path='/signin'>\n                        <Login onClick={this.handleAuthRegClick} setLoggedIn={this.handleSetLoggedIn} />\n                    </Route>\n                    <Route path='*'>\n                        <Redirect to=\"/signin\" />\n                    </Route>\n                </Switch>\n                \n                {/* Popup ToolTip for Registration/Login */}\n                <InfoToolTip isOpen={this.state.isInfoToolTipOpen} success={this.state.regSuccess} onClose={this.closeAllPopups} />    \n\n                {/* Popup Edit User Info Form */}\n                <EditProfilePopup isOpen={this.state.isEditProfileOpen} onClose={this.closeAllPopups} onUpdateUser={this.handleUpdateUser} />\n\n                {/* Popup Edit User Pic Form */}\n                <EditAvatarPopup isOpen={this.state.isEditAvatarOpen} onClose={this.closeAllPopups} onUpdateAvatar={this.handleUpdateAvatar} />\n\n                {/* Popup Add Form */}\n                <AddPlacePopup isOpen={this.state.isAddPlaceOpen} onClose={this.closeAllPopups} onAddPlace={this.handleAddPlace} />\n\n                {/* Popup Delete Form */}\n                <PopupWithForm name=\"form-delete\" title=\"Are you sure?\" isOpen={null} btnText=\"Yes\" onClose={this.closeAllPopups} />\n\n                {/* Image Popup */}\n                <ImagePopup card={this.state.selectedCard} onClose={this.closeAllPopups} />\n\n            </CurrentUserContext.Provider>\n        );\n    }\n}\n\nexport default withRouter(App);"]},"metadata":{},"sourceType":"module"}