{"ast":null,"code":"import _toConsumableArray from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Route,Switch,Redirect,withRouter}from'react-router-dom';import Main from'./Main.js';import PopupWithForm from'./PopupWithForm.js';import ImagePopup from'./ImagePopup.js';import api from'../utils/api.js';import CurrentUserContext from'../contexts/CurrentUserContext.js';import EditProfilePopup from'./EditProfilePopup.js';import EditAvatarPopup from'./EditAvatarPopup.js';import AddPlacePopup from'./AddPlacePopup.js';import ProtectedRoute from'./ProtectedRoute';import Register from'./Register';import Login from'./Login';import InfoToolTip from'./InfoToolTip';import*as auth from'../utils/auth.js';var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(){var _this;_classCallCheck(this,App);_this=_super.call(this);_this.state={isLoggedIn:null,userEmail:'',currentUser:{},isEditProfileOpen:false,isAddPlaceOpen:false,isEditAvatarOpen:false,isInfoToolTipOpen:false,regSuccess:false,selectedCard:null,cards:[]};_this.handleEditAvatarClick=_this.handleEditAvatarClick.bind(_assertThisInitialized(_this));_this.handleEditProfileClick=_this.handleEditProfileClick.bind(_assertThisInitialized(_this));_this.handleAddPlaceClick=_this.handleAddPlaceClick.bind(_assertThisInitialized(_this));_this.handleAuthRegClick=_this.handleAuthRegClick.bind(_assertThisInitialized(_this));_this.closeAllPopups=_this.closeAllPopups.bind(_assertThisInitialized(_this));_this.handleCardClick=_this.handleCardClick.bind(_assertThisInitialized(_this));_this.handleUpdateUser=_this.handleUpdateUser.bind(_assertThisInitialized(_this));_this.handleUpdateAvatar=_this.handleUpdateAvatar.bind(_assertThisInitialized(_this));_this.handleCardLike=_this.handleCardLike.bind(_assertThisInitialized(_this));_this.handleCardDelete=_this.handleCardDelete.bind(_assertThisInitialized(_this));_this.handleAddPlace=_this.handleAddPlace.bind(_assertThisInitialized(_this));_this.handleSetLoggedIn=_this.handleSetLoggedIn.bind(_assertThisInitialized(_this));return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;// Get user info for profile section\napi.getUserInfo().then(function(res){_this2.setState({currentUser:res});}).catch(function(err){console.log(err);});// Get initial cards\napi.getInitialCards().then(function(res){_this2.setState({cards:res});}).catch(function(err){console.log(err);});// Check if user has jwt token\nvar jwt=localStorage.getItem('jwt');if(jwt){auth.getUser(jwt).then(function(res){if(res){_this2.setState({isLoggedIn:true,userEmail:res.data.email});}}).then(function(){_this2.props.history.push('/');;});}}},{key:\"handleSetLoggedIn\",value:function handleSetLoggedIn(_ref){var loggedIn=_ref.loggedIn,email=_ref.email;this.setState({isLoggedIn:loggedIn,userEmail:email});}},{key:\"handleEditAvatarClick\",value:function handleEditAvatarClick(){this.setState({isEditAvatarOpen:true});}},{key:\"handleEditProfileClick\",value:function handleEditProfileClick(){this.setState({isEditProfileOpen:true});}},{key:\"handleAddPlaceClick\",value:function handleAddPlaceClick(){this.setState({isAddPlaceOpen:true});}},{key:\"handleAuthRegClick\",value:function handleAuthRegClick(result){this.setState({regSuccess:result,isInfoToolTipOpen:true});}},{key:\"closeAllPopups\",value:function closeAllPopups(){this.setState({isEditAvatarOpen:false,isEditProfileOpen:false,isAddPlaceOpen:false,isInfoToolTipOpen:false,selectedCard:null});}},{key:\"handleCardClick\",value:function handleCardClick(card){this.setState({selectedCard:card});}},{key:\"handleUpdateUser\",value:function handleUpdateUser(newInfo){var _this3=this;api.patchUserInfo(newInfo).then(function(res){_this3.setState({currentUser:res});}).catch(function(err){console.log(err);});}},{key:\"handleUpdateAvatar\",value:function handleUpdateAvatar(avatar){var _this4=this;api.patchUserPic(avatar).then(function(res){_this4.setState({currentUser:res});}).catch(function(err){console.log(err);});}},{key:\"handleCardLike\",value:function handleCardLike(card){var _this5=this;var isLiked=card.likes.some(function(i){return i._id===_this5.state.currentUser._id;});api.likeCard(card,isLiked).then(function(res){var newCards=_this5.state.cards.map(function(c){return c._id===card._id?res:c;});_this5.setState({cards:newCards});}).catch(function(err){console.log(err);});}},{key:\"handleCardDelete\",value:function handleCardDelete(card){var _this6=this;api.deleteCard(card._id).then(function(){var newCards=_this6.state.cards.filter(function(c){return c._id!==card._id;});_this6.setState({cards:newCards});});}},{key:\"handleAddPlace\",value:function handleAddPlace(card){var _this7=this;api.addNewCard(card).then(function(res){var newCards=[].concat(_toConsumableArray(_this7.state.cards),[res]);_this7.setState({cards:newCards});});}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(CurrentUserContext.Provider,{value:this.state.currentUser},/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(ProtectedRoute,{exact:true,path:\"/\",component:Main,loggedIn:this.state.isLoggedIn,userEmail:this.state.userEmail,onEditProfile:this.handleEditProfileClick,onAddPlace:this.handleAddPlaceClick,onEditAvatar:this.handleEditAvatarClick,onCardClick:this.handleCardClick,onClose:this.closeAllPopups,cards:this.state.cards,onCardLike:this.handleCardLike,onCardDelete:this.handleCardDelete,setLoggedIn:this.handleSetLoggedIn}),/*#__PURE__*/React.createElement(Route,{path:\"/signup\"},/*#__PURE__*/React.createElement(Register,{onClick:this.handleAuthRegClick})),/*#__PURE__*/React.createElement(Route,{path:\"/signin\"},/*#__PURE__*/React.createElement(Login,{onClick:this.handleAuthRegClick,setLoggedIn:this.handleSetLoggedIn})),/*#__PURE__*/React.createElement(Route,{path:\"*\"},/*#__PURE__*/React.createElement(Redirect,{to:\"/signin\"}))),/*#__PURE__*/React.createElement(InfoToolTip,{isOpen:this.state.isInfoToolTipOpen,success:this.state.regSuccess,onClose:this.closeAllPopups}),/*#__PURE__*/React.createElement(EditProfilePopup,{isOpen:this.state.isEditProfileOpen,onClose:this.closeAllPopups,onUpdateUser:this.handleUpdateUser}),/*#__PURE__*/React.createElement(EditAvatarPopup,{isOpen:this.state.isEditAvatarOpen,onClose:this.closeAllPopups,onUpdateAvatar:this.handleUpdateAvatar}),/*#__PURE__*/React.createElement(AddPlacePopup,{isOpen:this.state.isAddPlaceOpen,onClose:this.closeAllPopups,onAddPlace:this.handleAddPlace}),/*#__PURE__*/React.createElement(PopupWithForm,{name:\"form-delete\",title:\"Are you sure?\",isOpen:null,btnText:\"Yes\",onClose:this.closeAllPopups}),/*#__PURE__*/React.createElement(ImagePopup,{card:this.state.selectedCard,onClose:this.closeAllPopups}));}}]);return App;}(React.Component);export default withRouter(App);","map":{"version":3,"sources":["/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","withRouter","Main","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","Register","Login","InfoToolTip","auth","App","state","isLoggedIn","userEmail","currentUser","isEditProfileOpen","isAddPlaceOpen","isEditAvatarOpen","isInfoToolTipOpen","regSuccess","selectedCard","cards","handleEditAvatarClick","bind","handleEditProfileClick","handleAddPlaceClick","handleAuthRegClick","closeAllPopups","handleCardClick","handleUpdateUser","handleUpdateAvatar","handleCardLike","handleCardDelete","handleAddPlace","handleSetLoggedIn","getUserInfo","then","res","setState","catch","err","console","log","getInitialCards","jwt","localStorage","getItem","getUser","data","email","props","history","push","loggedIn","result","card","newInfo","patchUserInfo","avatar","patchUserPic","isLiked","likes","some","i","_id","likeCard","newCards","map","c","deleteCard","filter","addNewCard","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip'\nimport * as auth from '../utils/auth.js';\n\nclass App extends React.Component {\n    constructor() {\n        super();\n        this.state={\n            isLoggedIn: null,\n            userEmail: '',\n            currentUser: {},\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isEditAvatarOpen: false,\n            isInfoToolTipOpen: false,\n            regSuccess: false,\n            selectedCard: null,\n            cards: [],\n        };\n        this.handleEditAvatarClick = this.handleEditAvatarClick.bind(this);\n        this.handleEditProfileClick = this.handleEditProfileClick.bind(this);\n        this.handleAddPlaceClick = this.handleAddPlaceClick.bind(this);\n        this.handleAuthRegClick = this.handleAuthRegClick.bind(this);\n        this.closeAllPopups = this.closeAllPopups.bind(this);\n        this.handleCardClick = this.handleCardClick.bind(this);\n        this.handleUpdateUser = this.handleUpdateUser.bind(this);\n        this.handleUpdateAvatar = this.handleUpdateAvatar.bind(this);\n        this.handleCardLike = this.handleCardLike.bind(this);\n        this.handleCardDelete = this.handleCardDelete.bind(this);\n        this.handleAddPlace= this.handleAddPlace.bind(this);\n        this.handleSetLoggedIn = this.handleSetLoggedIn.bind(this);\n    }\n\n    componentDidMount() {\n        // Get user info for profile section\n        api.getUserInfo().then((res) => { \n            this.setState({ currentUser: res}); \n        }).catch((err) => { \n            console.log(err) \n        });\n        \n        // Get initial cards\n        api.getInitialCards().then((res) => { \n            this.setState({ cards: res}); \n        }).catch((err) => { \n            console.log(err) \n        });\n\n        // Check if user has jwt token\n        const jwt = localStorage.getItem('jwt');\n        if (jwt) {\n            auth.getUser(jwt).then((res) => {\n                if (res) {\n                    this.setState({ \n                        isLoggedIn: true,\n                        userEmail: res.data.email\n                    });\n                }\n            }).then(() => {\n                this.props.history.push('/'); ;\n            });\n        }   \n    }\n\n    handleSetLoggedIn({loggedIn, email}) {\n        this.setState({\n            isLoggedIn: loggedIn,\n            userEmail: email\n        })\n    }\n\n    handleEditAvatarClick() {\n        this.setState({ isEditAvatarOpen: true });\n    }\n\n    handleEditProfileClick() {\n        this.setState({ isEditProfileOpen: true });\n    }\n\n    handleAddPlaceClick() {\n        this.setState({ isAddPlaceOpen: true });\n    }\n\n    handleAuthRegClick(result) {\n        this.setState({\n            regSuccess: result,\n            isInfoToolTipOpen: true\n        });\n    }\n\n    closeAllPopups() {\n        this.setState({\n            isEditAvatarOpen: false,\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isInfoToolTipOpen: false,\n            selectedCard: null\n        });\n    }\n\n    handleCardClick(card) {\n        this.setState({ selectedCard: card });\n    }\n\n    handleUpdateUser(newInfo) {\n        api.patchUserInfo(newInfo)\n            .then((res) => { this.setState({ currentUser: res })})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleUpdateAvatar(avatar) {\n        api.patchUserPic(avatar)\n            .then((res) => { this.setState({ currentUser: res })})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n        api.likeCard(card, isLiked)\n            .then((res) => {\n                const newCards = this.state.cards.map((c) => c._id === card._id ? res : c);\n                this.setState({ cards: newCards });\n            })\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(() => {\n                const newCards = this.state.cards.filter((c) => c._id !== card._id);\n                this.setState({ cards: newCards });\n            });\n    }\n\n    handleAddPlace(card) {\n        api.addNewCard(card)\n            .then((res) => {\n                const newCards = [...this.state.cards, res];\n                this.setState({ cards: newCards });\n            });\n    }\n\n    render() {\n        return (\n            <CurrentUserContext.Provider value={this.state.currentUser}>\n                <Switch>\n                    <ProtectedRoute exact path=\"/\" component={Main} loggedIn={this.state.isLoggedIn} userEmail={this.state.userEmail} \n                        onEditProfile={this.handleEditProfileClick} onAddPlace={this.handleAddPlaceClick} onEditAvatar={this.handleEditAvatarClick}\n                        onCardClick={this.handleCardClick} onClose={this.closeAllPopups} cards={this.state.cards} onCardLike={this.handleCardLike} \n                        onCardDelete={this.handleCardDelete} setLoggedIn={this.handleSetLoggedIn}/>\n                    <Route path='/signup'>\n                        <Register onClick={this.handleAuthRegClick} />\n                    </Route>\n                    <Route path='/signin'>\n                        <Login onClick={this.handleAuthRegClick} setLoggedIn={this.handleSetLoggedIn} />\n                    </Route>\n                    <Route path='*'>\n                        <Redirect to=\"/signin\" />\n                    </Route>\n                </Switch>\n                \n                {/* Popup ToolTip for Registration/Login */}\n                <InfoToolTip isOpen={this.state.isInfoToolTipOpen} success={this.state.regSuccess} onClose={this.closeAllPopups} />    \n\n                {/* Popup Edit User Info Form */}\n                <EditProfilePopup isOpen={this.state.isEditProfileOpen} onClose={this.closeAllPopups} onUpdateUser={this.handleUpdateUser} />\n\n                {/* Popup Edit User Pic Form */}\n                <EditAvatarPopup isOpen={this.state.isEditAvatarOpen} onClose={this.closeAllPopups} onUpdateAvatar={this.handleUpdateAvatar} />\n\n                {/* Popup Add Form */}\n                <AddPlacePopup isOpen={this.state.isAddPlaceOpen} onClose={this.closeAllPopups} onAddPlace={this.handleAddPlace} />\n\n                {/* Popup Delete Form */}\n                <PopupWithForm name=\"form-delete\" title=\"Are you sure?\" isOpen={null} btnText=\"Yes\" onClose={this.closeAllPopups} />\n\n                {/* Image Popup */}\n                <ImagePopup card={this.state.selectedCard} onClose={this.closeAllPopups} />\n\n            </CurrentUserContext.Provider>\n        );\n    }\n}\n\nexport default withRouter(App);"]},"metadata":{},"sourceType":"module"}