{"ast":null,"code":"var _jsxFileName = \"/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js\";\nimport React from 'react';\nimport { Route, Switch, Redirect } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip';\nimport * as auth from '../utils/auth.js';\nimport { render } from '@testing-library/react';\n\nclass App extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      isLoggedIn: false,\n      userEmail: '',\n      currentUser: {},\n      isEditProfileOpen: false,\n      isAddPlaceOpen: false,\n      isEditAvatarOpen: false,\n      isInfoToolTipOpen: false,\n      regSuccess: false,\n      selectedCard: null,\n      cards: []\n    };\n    this.handleEditAvatarClick = this.handleEditAvatarClick.bind(this);\n    this.handleEditProfileClick = this.handleEditProfileClick.bind(this);\n    this.handleAddPlaceClick = this.handleAddPlaceClick.bind(this);\n    this.handleAuthRegClick = this.handleAuthRegClick.bind(this);\n    this.closeAllPopups = this.closeAllPopups.bind(this);\n    this.handleCardClick = this.handleCardClick.bind(this);\n    this.handleUpdateUser = this.handleUpdateUser.bind(this);\n    this.handleUpdateAvatar = this.handleUpdateAvatar.bind(this);\n    this.handleCardLike = this.handleCardLike.bind(this);\n    this.handleCardDelete = this.handleCardDelete.bind(this);\n    this.handleAddPlace = this.handleAddPlace.bind(this);\n  }\n\n  componentDidMount() {\n    // Get user info for profile section\n    api.getUserInfo().then(res => {\n      this.state.CurrentUser(res);\n    }).catch(err => {\n      console.log(err);\n    }); // Get initial cards\n\n    api.getInitialCards().then(res => {\n      this.state.Cards(res);\n    }).catch(err => {\n      console.log(err);\n    }); // Check if user has jwt token\n\n    const jwt = localStorage.getItem('jwt');\n\n    if (jwt) {\n      auth.getUser(jwt).then(res => {\n        if (res) {\n          console.log('Made it to the token check on mount');\n          console.log(this.state.isLoggedIn);\n        }\n      }).then(() => {\n        this.setState({\n          isLoggedIn: true\n        });\n      });\n    }\n  }\n\n  handleEditAvatarClick() {\n    this.setState({\n      isEditAvatarOpen: true\n    });\n  }\n\n  handleEditProfileClick() {\n    this.setState({\n      isEditProfileOpen: true\n    });\n  }\n\n  handleAddPlaceClick() {\n    this.setState({\n      isAddPlaceOpen: true\n    });\n  }\n\n  handleAuthRegClick(result) {\n    this.setState({\n      regSuccess: result,\n      isInfoToolTipOpen: true\n    });\n  }\n\n  closeAllPopups() {\n    this.setState({\n      isEditAvatarOpen: false,\n      isEditProfileOpen: false,\n      isAddPlaceOpen: false,\n      isInfoToolTipOpen: false,\n      selectedCard: null\n    });\n  }\n\n  handleCardClick(card) {\n    this.setState({\n      selectedCard: card\n    });\n  }\n\n  handleUpdateUser(newInfo) {\n    api.patchUserInfo(newInfo).then(res => {\n      this.setState({\n        currentUser: res\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleUpdateAvatar(avatar) {\n    api.patchUserPic(avatar).then(res => {\n      this.setState({\n        currentUser: res\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n    api.likeCard(card, isLiked).then(res => {\n      const newCards = this.state.cards.map(c => c._id === card._id ? res : c);\n      this.setState({\n        cards: newCards\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleCardDelete(card) {\n    api.deleteCard(card._id).then(() => {\n      const newCards = this.state.cards.filter(c => c._id !== card._id);\n      this.setState({\n        cards: newCards\n      });\n    });\n  }\n\n  handleAddPlace(card) {\n    api.addNewCard(card).then(res => {\n      const newCards = [...this.state.cards, res];\n      this.setState({\n        cards: newCards\n      });\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n      value: this.state.currentUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(ProtectedRoute, {\n      exact: true,\n      path: \"/\",\n      component: Main,\n      loggedIn: this.isLoggedIn,\n      userEmail: this.isLoggedIn,\n      onEditProfile: this.handleEditProfileClick,\n      onAddPlace: this.handleAddPlaceClick,\n      onEditAvatar: this.handleEditAvatarClick,\n      onCardClick: this.handleCardClick,\n      onClose: this.closeAllPopups,\n      cards: this.state.cards,\n      onCardLike: this.handleCardLike,\n      onCardDelete: this.handleCardDelete,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/signup\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Register, {\n      onClick: this.handleAuthRegClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(Route, {\n      path: \"/signin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Login, {\n      onClick: this.handleAuthRegClick,\n      setUser: this.state.IsLoggedIn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(Route, {\n      path: \"*\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Redirect, {\n      to: \"/signin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 25\n      }\n    }))), /*#__PURE__*/React.createElement(InfoToolTip, {\n      isOpen: this.state.isInfoToolTipOpen,\n      success: this.state.regSuccess,\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(EditProfilePopup, {\n      isOpen: this.state.isEditProfileOpen,\n      onClose: this.closeAllPopups,\n      onUpdateUser: this.handleUpdateUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(EditAvatarPopup, {\n      isOpen: this.state.isEditAvatarOpen,\n      onClose: this.closeAllPopups,\n      onUpdateAvatar: this.handleUpdateAvatar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(AddPlacePopup, {\n      isOpen: this.state.isAddPlaceOpen,\n      onClose: this.closeAllPopups,\n      onAddPlace: this.handleAddPlace,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(PopupWithForm, {\n      name: \"form-delete\",\n      title: \"Are you sure?\",\n      isOpen: null,\n      btnText: \"Yes\",\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(ImagePopup, {\n      card: this.state.selectedCard,\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","Main","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","Register","Login","InfoToolTip","auth","render","App","Component","constructor","state","isLoggedIn","userEmail","currentUser","isEditProfileOpen","isAddPlaceOpen","isEditAvatarOpen","isInfoToolTipOpen","regSuccess","selectedCard","cards","handleEditAvatarClick","bind","handleEditProfileClick","handleAddPlaceClick","handleAuthRegClick","closeAllPopups","handleCardClick","handleUpdateUser","handleUpdateAvatar","handleCardLike","handleCardDelete","handleAddPlace","componentDidMount","getUserInfo","then","res","CurrentUser","catch","err","console","log","getInitialCards","Cards","jwt","localStorage","getItem","getUser","setState","result","card","newInfo","patchUserInfo","avatar","patchUserPic","isLiked","likes","some","i","_id","likeCard","newCards","map","c","deleteCard","filter","addNewCard","IsLoggedIn"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, Redirect } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip'\nimport * as auth from '../utils/auth.js';\nimport { render } from '@testing-library/react';\n\nclass App extends React.Component {\n    constructor() {\n        super();\n        this.state={\n            isLoggedIn: false,\n            userEmail: '',\n            currentUser: {},\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isEditAvatarOpen: false,\n            isInfoToolTipOpen: false,\n            regSuccess: false,\n            selectedCard: null,\n            cards: [],\n        }\n        this.handleEditAvatarClick = this.handleEditAvatarClick.bind(this);\n        this.handleEditProfileClick = this.handleEditProfileClick.bind(this);\n        this.handleAddPlaceClick = this.handleAddPlaceClick.bind(this);\n        this.handleAuthRegClick = this.handleAuthRegClick.bind(this);\n        this.closeAllPopups = this.closeAllPopups.bind(this);\n        this.handleCardClick = this.handleCardClick.bind(this);\n        this.handleUpdateUser = this.handleUpdateUser.bind(this);\n        this.handleUpdateAvatar = this.handleUpdateAvatar.bind(this);\n        this.handleCardLike = this.handleCardLike.bind(this);\n        this.handleCardDelete = this.handleCardDelete.bind(this);\n        this.handleAddPlace= this.handleAddPlace.bind(this);\n    }\n\n    componentDidMount() {\n        // Get user info for profile section\n        api.getUserInfo().then((res) => { \n            this.state.CurrentUser(res); \n        }).catch((err) => { \n            console.log(err) \n        });\n        \n        // Get initial cards\n        api.getInitialCards().then((res) => { \n            this.state.Cards(res); \n        }).catch((err) => { \n            console.log(err) \n        });\n\n        // Check if user has jwt token\n        const jwt = localStorage.getItem('jwt');\n        if (jwt) {\n            auth.getUser(jwt).then((res) => {\n                if (res) {\n                    console.log('Made it to the token check on mount')\n                    console.log(this.state.isLoggedIn);\n                }\n            }).then(() => {\n                this.setState({ isLoggedIn: true });\n            });\n        }   \n    }\n\n    handleEditAvatarClick() {\n        this.setState({ isEditAvatarOpen: true });\n    }\n\n    handleEditProfileClick() {\n        this.setState({ isEditProfileOpen: true });\n    }\n\n    handleAddPlaceClick() {\n        this.setState({ isAddPlaceOpen: true });\n    }\n\n    handleAuthRegClick(result) {\n        this.setState({\n            regSuccess: result,\n            isInfoToolTipOpen: true\n        });\n    }\n\n    closeAllPopups() {\n        this.setState({\n            isEditAvatarOpen: false,\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isInfoToolTipOpen: false,\n            selectedCard: null\n        });\n    }\n\n    handleCardClick(card) {\n        this.setState({ selectedCard: card });\n    }\n\n    handleUpdateUser(newInfo) {\n        api.patchUserInfo(newInfo)\n            .then((res) => { this.setState({ currentUser: res })})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleUpdateAvatar(avatar) {\n        api.patchUserPic(avatar)\n            .then((res) => { this.setState({ currentUser: res })})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n        api.likeCard(card, isLiked)\n            .then((res) => {\n                const newCards = this.state.cards.map((c) => c._id === card._id ? res : c);\n                this.setState({ cards: newCards });\n            })\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(() => {\n                const newCards = this.state.cards.filter((c) => c._id !== card._id);\n                this.setState({ cards: newCards });\n            });\n    }\n\n    handleAddPlace(card) {\n        api.addNewCard(card)\n            .then((res) => {\n                const newCards = [...this.state.cards, res];\n                this.setState({ cards: newCards });\n            });\n    }\n\n    render() {\n        return (\n            <CurrentUserContext.Provider value={this.state.currentUser}>\n                <Switch>\n                    <ProtectedRoute exact path=\"/\" component={Main} loggedIn={this.isLoggedIn} userEmail={this.isLoggedIn} onEditProfile={this.handleEditProfileClick} onAddPlace={this.handleAddPlaceClick} onEditAvatar={this.handleEditAvatarClick}\n                        onCardClick={this.handleCardClick} onClose={this.closeAllPopups} cards={this.state.cards} onCardLike={this.handleCardLike} onCardDelete={this.handleCardDelete} />\n                    <Route path='/signup'>\n                        <Register onClick={this.handleAuthRegClick} />\n                    </Route>\n                    <Route path='/signin'>\n                        <Login onClick={this.handleAuthRegClick} setUser={this.state.IsLoggedIn} />\n                    </Route>\n                    <Route path='*'>\n                        <Redirect to=\"/signin\" />\n                    </Route>\n                </Switch>\n                \n                {/* Popup ToolTip for Registration/Login */}\n                <InfoToolTip isOpen={this.state.isInfoToolTipOpen} success={this.state.regSuccess} onClose={this.closeAllPopups} />    \n\n                {/* Popup Edit User Info Form */}\n                <EditProfilePopup isOpen={this.state.isEditProfileOpen} onClose={this.closeAllPopups} onUpdateUser={this.handleUpdateUser} />\n\n                {/* Popup Edit User Pic Form */}\n                <EditAvatarPopup isOpen={this.state.isEditAvatarOpen} onClose={this.closeAllPopups} onUpdateAvatar={this.handleUpdateAvatar} />\n\n                {/* Popup Add Form */}\n                <AddPlacePopup isOpen={this.state.isAddPlaceOpen} onClose={this.closeAllPopups} onAddPlace={this.handleAddPlace} />\n\n                {/* Popup Delete Form */}\n                <PopupWithForm name=\"form-delete\" title=\"Are you sure?\" isOpen={null} btnText=\"Yes\" onClose={this.closeAllPopups} />\n\n                {/* Image Popup */}\n                <ImagePopup card={this.state.selectedCard} onClose={this.closeAllPopups} />\n\n            </CurrentUserContext.Provider>\n        );\n    }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}