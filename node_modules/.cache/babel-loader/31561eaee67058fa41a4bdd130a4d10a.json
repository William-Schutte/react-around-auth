{"ast":null,"code":"var _jsxFileName = \"/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js\";\nimport React from 'react';\nimport { Route, Switch, Redirect } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip';\nimport * as auth from '../utils/auth.js';\nimport { render } from '@testing-library/react';\n\nclass App extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      isLoggedIn: false,\n      userEmail: '',\n      currentUser: {},\n      isEditProfileOpen: false,\n      isAddPlaceOpen: false,\n      isEditAvatarOpen: false,\n      isInfoToolTipOpen: false,\n      regSuccess: false,\n      selectedCard: null,\n      cards: []\n    };\n  }\n\n  componentDidMount() {\n    // Get user info for profile section\n    api.getUserInfo().then(res => {\n      this.state.CurrentUser(res);\n    }).catch(err => {\n      console.log(err);\n    }); // Get initial cards\n\n    api.getInitialCards().then(res => {\n      this.state.Cards(res);\n    }).catch(err => {\n      console.log(err);\n    }); // Check if user has jwt token\n\n    const jwt = localStorage.getItem('jwt');\n\n    if (jwt) {\n      auth.getUser(jwt).then(res => {\n        if (res) {\n          console.log('Made it to the token check on mount');\n          console.log(this.state.isLoggedIn);\n        }\n      }).then(() => {\n        this.setState({\n          isLoggedIn: true\n        });\n      });\n    }\n  }\n\n  handleEditAvatarClick() {\n    this.setState({\n      isEditAvatarOpen: true\n    });\n  }\n\n  handleEditProfileClick() {\n    this.setState({\n      isEditProfileOpen: true\n    });\n  }\n\n  handleAddPlaceClick() {\n    this.setState({\n      isAddPlaceOpen: true\n    });\n  }\n\n  handleAuthRegClick(result) {\n    this.setState({\n      regSuccess: result,\n      isInfoToolTipOpen: true\n    });\n  }\n\n  closeAllPopups() {\n    this.setState({\n      isEditAvatarOpen: false,\n      isEditProfileOpen: false,\n      isAddPlaceOpen: false,\n      isInfoToolTipOpen: false,\n      selectedCard: null\n    });\n  }\n\n  handleCardClick(card) {\n    this.setState({\n      selectedCard: card\n    });\n  }\n\n  handleUpdateUser(newInfo) {\n    api.patchUserInfo(newInfo).then(res => {\n      this.setState({\n        currentUser: res\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleUpdateAvatar(avatar) {\n    api.patchUserPic(avatar).then(res => {\n      this.setState({\n        currentUser: res\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n    api.likeCard(card, isLiked).then(res => {\n      const newCards = this.state.cards.map(c => c._id === card._id ? res : c);\n      this.setState({\n        cards: newCards\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleCardDelete(card) {\n    api.deleteCard(card._id).then(() => {\n      const newCards = this.state.cards.filter(c => c._id !== card._id);\n      this.setState({\n        cards: newCards\n      });\n    });\n  }\n\n  handleAddPlace(card) {\n    api.addNewCard(card).then(res => {\n      const newCards = [...this.state.cards, res];\n      this.setState({\n        cards: newCards\n      });\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n      value: this.state.currentUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(ProtectedRoute, {\n      exact: true,\n      path: \"/\",\n      component: Main,\n      loggedIn: this.isLoggedIn,\n      userEmail: this.isLoggedIn,\n      onEditProfile: this.handleEditProfileClick,\n      onAddPlace: this.handleAddPlaceClick,\n      onEditAvatar: this.handleEditAvatarClick,\n      onCardClick: this.handleCardClick,\n      onClose: this.closeAllPopups,\n      cards: this.state.cards,\n      onCardLike: this.handleCardLike,\n      onCardDelete: this.handleCardDelete,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/signup\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Register, {\n      onClick: this.handleAuthRegClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(Route, {\n      path: \"/signin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Login, {\n      onClick: this.handleAuthRegClick,\n      setUser: this.state.IsLoggedIn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(Route, {\n      path: \"*\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Redirect, {\n      to: \"/signin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 25\n      }\n    }))), /*#__PURE__*/React.createElement(InfoToolTip, {\n      isOpen: this.state.isInfoToolTipOpen,\n      success: this.state.regSuccess,\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(EditProfilePopup, {\n      isOpen: this.state.isEditProfileOpen,\n      onClose: this.closeAllPopups,\n      onUpdateUser: this.handleUpdateUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(EditAvatarPopup, {\n      isOpen: this.state.isEditAvatarOpen,\n      onClose: this.closeAllPopups,\n      onUpdateAvatar: this.handleUpdateAvatar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(AddPlacePopup, {\n      isOpen: this.state.isAddPlaceOpen,\n      onClose: this.closeAllPopups,\n      onAddPlace: this.handleAddPlace,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(PopupWithForm, {\n      name: \"form-delete\",\n      title: \"Are you sure?\",\n      isOpen: null,\n      btnText: \"Yes\",\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(ImagePopup, {\n      card: this.state.selectedCard,\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","Main","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","Register","Login","InfoToolTip","auth","render","App","Component","constructor","state","isLoggedIn","userEmail","currentUser","isEditProfileOpen","isAddPlaceOpen","isEditAvatarOpen","isInfoToolTipOpen","regSuccess","selectedCard","cards","componentDidMount","getUserInfo","then","res","CurrentUser","catch","err","console","log","getInitialCards","Cards","jwt","localStorage","getItem","getUser","setState","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleAuthRegClick","result","closeAllPopups","handleCardClick","card","handleUpdateUser","newInfo","patchUserInfo","handleUpdateAvatar","avatar","patchUserPic","handleCardLike","isLiked","likes","some","i","_id","likeCard","newCards","map","c","handleCardDelete","deleteCard","filter","handleAddPlace","addNewCard","IsLoggedIn"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, Redirect } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip'\nimport * as auth from '../utils/auth.js';\nimport { render } from '@testing-library/react';\n\nclass App extends React.Component {\n    constructor() {\n        super();\n        this.state={\n            isLoggedIn: false,\n            userEmail: '',\n            currentUser: {},\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isEditAvatarOpen: false,\n            isInfoToolTipOpen: false,\n            regSuccess: false,\n            selectedCard: null,\n            cards: [],\n        }\n    }\n\n    componentDidMount() {\n        // Get user info for profile section\n        api.getUserInfo().then((res) => { \n            this.state.CurrentUser(res); \n        }).catch((err) => { \n            console.log(err) \n        });\n        \n        // Get initial cards\n        api.getInitialCards().then((res) => { \n            this.state.Cards(res); \n        }).catch((err) => { \n            console.log(err) \n        });\n\n        // Check if user has jwt token\n        const jwt = localStorage.getItem('jwt');\n        if (jwt) {\n            auth.getUser(jwt).then((res) => {\n                if (res) {\n                    console.log('Made it to the token check on mount')\n                    console.log(this.state.isLoggedIn);\n                }\n            }).then(() => {\n                this.setState({ isLoggedIn: true });\n            });\n        }   \n    }\n\n    handleEditAvatarClick() {\n        this.setState({ isEditAvatarOpen: true });\n    }\n\n    handleEditProfileClick() {\n        this.setState({ isEditProfileOpen: true });\n    }\n\n    handleAddPlaceClick() {\n        this.setState({ isAddPlaceOpen: true });\n    }\n\n    handleAuthRegClick(result) {\n        this.setState({\n            regSuccess: result,\n            isInfoToolTipOpen: true\n        });\n    }\n\n    closeAllPopups() {\n        this.setState({\n            isEditAvatarOpen: false,\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isInfoToolTipOpen: false,\n            selectedCard: null\n        });\n    }\n\n    handleCardClick(card) {\n        this.setState({ selectedCard: card });\n    }\n\n    handleUpdateUser(newInfo) {\n        api.patchUserInfo(newInfo)\n            .then((res) => { this.setState({ currentUser: res })})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleUpdateAvatar(avatar) {\n        api.patchUserPic(avatar)\n            .then((res) => { this.setState({ currentUser: res })})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n        api.likeCard(card, isLiked)\n            .then((res) => {\n                const newCards = this.state.cards.map((c) => c._id === card._id ? res : c);\n                this.setState({ cards: newCards });\n            })\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(() => {\n                const newCards = this.state.cards.filter((c) => c._id !== card._id);\n                this.setState({ cards: newCards });\n            });\n    }\n\n    handleAddPlace(card) {\n        api.addNewCard(card)\n            .then((res) => {\n                const newCards = [...this.state.cards, res];\n                this.setState({ cards: newCards });\n            });\n    }\n\n    render() {\n        return (\n            <CurrentUserContext.Provider value={this.state.currentUser}>\n                <Switch>\n                    <ProtectedRoute exact path=\"/\" component={Main} loggedIn={this.isLoggedIn} userEmail={this.isLoggedIn} onEditProfile={this.handleEditProfileClick} onAddPlace={this.handleAddPlaceClick} onEditAvatar={this.handleEditAvatarClick}\n                        onCardClick={this.handleCardClick} onClose={this.closeAllPopups} cards={this.state.cards} onCardLike={this.handleCardLike} onCardDelete={this.handleCardDelete} />\n                    <Route path='/signup'>\n                        <Register onClick={this.handleAuthRegClick} />\n                    </Route>\n                    <Route path='/signin'>\n                        <Login onClick={this.handleAuthRegClick} setUser={this.state.IsLoggedIn} />\n                    </Route>\n                    <Route path='*'>\n                        <Redirect to=\"/signin\" />\n                    </Route>\n                </Switch>\n                \n                {/* Popup ToolTip for Registration/Login */}\n                <InfoToolTip isOpen={this.state.isInfoToolTipOpen} success={this.state.regSuccess} onClose={this.closeAllPopups} />    \n\n                {/* Popup Edit User Info Form */}\n                <EditProfilePopup isOpen={this.state.isEditProfileOpen} onClose={this.closeAllPopups} onUpdateUser={this.handleUpdateUser} />\n\n                {/* Popup Edit User Pic Form */}\n                <EditAvatarPopup isOpen={this.state.isEditAvatarOpen} onClose={this.closeAllPopups} onUpdateAvatar={this.handleUpdateAvatar} />\n\n                {/* Popup Add Form */}\n                <AddPlacePopup isOpen={this.state.isAddPlaceOpen} onClose={this.closeAllPopups} onAddPlace={this.handleAddPlace} />\n\n                {/* Popup Delete Form */}\n                <PopupWithForm name=\"form-delete\" title=\"Are you sure?\" isOpen={null} btnText=\"Yes\" onClose={this.closeAllPopups} />\n\n                {/* Image Popup */}\n                <ImagePopup card={this.state.selectedCard} onClose={this.closeAllPopups} />\n\n            </CurrentUserContext.Provider>\n        );\n    }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}