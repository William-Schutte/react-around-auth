{"ast":null,"code":"var _jsxFileName = \"/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js\";\nimport React from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip';\nimport * as auth from '../utils/auth.js';\n\nclass App extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      isLoggedIn: null,\n      userEmail: '',\n      currentUser: {},\n      jwt: '',\n      isEditProfileOpen: false,\n      isAddPlaceOpen: false,\n      isEditAvatarOpen: false,\n      isInfoToolTipOpen: false,\n      regSuccess: false,\n      selectedCard: null,\n      cards: []\n    };\n    this.handleEditAvatarClick = this.handleEditAvatarClick.bind(this);\n    this.handleEditProfileClick = this.handleEditProfileClick.bind(this);\n    this.handleAddPlaceClick = this.handleAddPlaceClick.bind(this);\n    this.handleAuthRegClick = this.handleAuthRegClick.bind(this);\n    this.closeAllPopups = this.closeAllPopups.bind(this);\n    this.handleCardClick = this.handleCardClick.bind(this);\n    this.handleUpdateUser = this.handleUpdateUser.bind(this);\n    this.handleUpdateAvatar = this.handleUpdateAvatar.bind(this);\n    this.handleCardLike = this.handleCardLike.bind(this);\n    this.handleCardDelete = this.handleCardDelete.bind(this);\n    this.handleAddPlace = this.handleAddPlace.bind(this);\n    this.handleLogIn = this.handleLogIn.bind(this);\n    this.handleLogOut = this.handleLogOut.bind(this);\n    this.handleRegister = this.handleRegister.bind(this);\n  }\n\n  componentDidMount() {\n    // Check if user has jwt token\n    const jwt = localStorage.getItem('jwt');\n\n    if (jwt) {\n      this.setState({\n        jwt: jwt\n      });\n      auth.getUser(jwt).then(res => {\n        if (res) {\n          console.log(res);\n          this.setState({\n            isLoggedIn: true,\n            userEmail: res.data.email,\n            currentUser: res.data\n          });\n        }\n      }).then(() => {\n        this.props.history.push('/');\n      }).catch(err => {\n        console.log(err);\n      });\n    } //  // Get user info for profile section\n    // api.getUserInfo(jwt).then((res) => { \n    //     this.setState({ currentUser: res }); \n    // }).catch((err) => { \n    //     console.log(err) \n    // });\n    // Get initial cards\n\n\n    api.getInitialCards(jwt).then(res => {\n      if (res) {\n        this.setState({\n          cards: res\n        });\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  } // componentDidUpdate() {\n  //     const jwt = localStorage.getItem('jwt');\n  //     // Get user info for profile section\n  //     api.getUserInfo(jwt).then((res) => { \n  //         this.setState({ currentUser: res}); \n  //     }).catch((err) => { \n  //         console.log(err) \n  //     });    \n  //     // Get initial cards\n  //     api.getInitialCards(jwt).then((res) => { \n  //         this.setState({ cards: res}); \n  //     }).catch((err) => { \n  //         console.log(err) \n  //     });\n  // }\n\n\n  handleLogIn(email, password) {\n    auth.authorize(email, password).then(res => {\n      console.log(res);\n\n      if (res) {\n        this.setState({\n          isLoggedIn: true,\n          userEmail: email\n        }, () => this.props.history.push('/'));\n      } else {\n        this.handleAuthRegClick(false);\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleRegister(email, password) {\n    auth.register(email, password).then(res => {\n      if (res) {\n        console.log(res);\n        this.handleAuthRegClick(true);\n        this.props.history.push('/signin');\n      } else {\n        this.handleAuthRegClick(false);\n      }\n    }).catch(err => {\n      this.handleAuthRegClick(false);\n      console.log(err);\n    });\n  }\n\n  handleLogOut() {\n    localStorage.removeItem('jwt');\n    this.setState({\n      isLoggedIn: false,\n      email: null\n    });\n  }\n\n  handleEditAvatarClick() {\n    this.setState({\n      isEditAvatarOpen: true\n    });\n  }\n\n  handleEditProfileClick() {\n    this.setState({\n      isEditProfileOpen: true\n    });\n  }\n\n  handleAddPlaceClick() {\n    this.setState({\n      isAddPlaceOpen: true\n    });\n  }\n\n  handleAuthRegClick(result) {\n    this.setState({\n      regSuccess: result,\n      isInfoToolTipOpen: true\n    });\n  }\n\n  closeAllPopups() {\n    this.setState({\n      isEditAvatarOpen: false,\n      isEditProfileOpen: false,\n      isAddPlaceOpen: false,\n      isInfoToolTipOpen: false,\n      selectedCard: null\n    });\n  }\n\n  handleCardClick(card) {\n    this.setState({\n      selectedCard: card\n    });\n  }\n\n  handleUpdateUser(newInfo) {\n    api.patchUserInfo({ ...newInfo,\n      token: this.state.api\n    }).then(res => {\n      this.setState({\n        currentUser: res\n      }, this.closeAllPopups());\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleUpdateAvatar(avatar) {\n    api.patchUserPic(avatar).then(res => {\n      this.setState({\n        currentUser: res\n      }, this.closeAllPopups());\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n    api.likeCard(card, isLiked).then(res => {\n      const newCards = this.state.cards.map(c => c._id === card._id ? res : c);\n      this.setState({\n        cards: newCards\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleCardDelete(card) {\n    api.deleteCard(card._id).then(() => {\n      const newCards = this.state.cards.filter(c => c._id !== card._id);\n      this.setState({\n        cards: newCards\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  handleAddPlace(card) {\n    api.addNewCard(card).then(res => {\n      const newCards = [...this.state.cards, res];\n      this.setState({\n        cards: newCards\n      }, this.closeAllPopups());\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n      value: this.state.currentUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(ProtectedRoute, {\n      exact: true,\n      path: \"/\",\n      component: Main,\n      loggedIn: this.state.isLoggedIn,\n      userEmail: this.state.userEmail,\n      onEditProfile: this.handleEditProfileClick,\n      onAddPlace: this.handleAddPlaceClick,\n      onEditAvatar: this.handleEditAvatarClick,\n      onCardClick: this.handleCardClick,\n      onClose: this.closeAllPopups,\n      cards: this.state.cards,\n      onCardLike: this.handleCardLike,\n      onCardDelete: this.handleCardDelete,\n      logOut: this.handleLogOut,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/signup\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Register, {\n      register: this.handleRegister,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(Route, {\n      path: \"/signin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Login, {\n      logIn: this.handleLogIn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(Route, {\n      path: \"*\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Redirect, {\n      to: \"/signin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 25\n      }\n    }))), /*#__PURE__*/React.createElement(InfoToolTip, {\n      isOpen: this.state.isInfoToolTipOpen,\n      success: this.state.regSuccess,\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(EditProfilePopup, {\n      isOpen: this.state.isEditProfileOpen,\n      onClose: this.closeAllPopups,\n      onUpdateUser: this.handleUpdateUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(EditAvatarPopup, {\n      isOpen: this.state.isEditAvatarOpen,\n      onClose: this.closeAllPopups,\n      onUpdateAvatar: this.handleUpdateAvatar,\n      currentUser: this.state.currentUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(AddPlacePopup, {\n      isOpen: this.state.isAddPlaceOpen,\n      onClose: this.closeAllPopups,\n      onAddPlace: this.handleAddPlace,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(ImagePopup, {\n      card: this.state.selectedCard,\n      onClose: this.closeAllPopups,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}\n\nexport default withRouter(App);","map":{"version":3,"sources":["/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","withRouter","Main","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","Register","Login","InfoToolTip","auth","App","Component","constructor","state","isLoggedIn","userEmail","currentUser","jwt","isEditProfileOpen","isAddPlaceOpen","isEditAvatarOpen","isInfoToolTipOpen","regSuccess","selectedCard","cards","handleEditAvatarClick","bind","handleEditProfileClick","handleAddPlaceClick","handleAuthRegClick","closeAllPopups","handleCardClick","handleUpdateUser","handleUpdateAvatar","handleCardLike","handleCardDelete","handleAddPlace","handleLogIn","handleLogOut","handleRegister","componentDidMount","localStorage","getItem","setState","getUser","then","res","console","log","data","email","props","history","push","catch","err","getInitialCards","password","authorize","register","removeItem","result","card","newInfo","patchUserInfo","token","avatar","patchUserPic","isLiked","likes","some","i","_id","likeCard","newCards","map","c","deleteCard","filter","addNewCard","render"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip'\nimport * as auth from '../utils/auth.js';\n\nclass App extends React.Component {\n    constructor() {\n        super();\n        this.state={\n            isLoggedIn: null,\n            userEmail: '',\n            currentUser: {},\n            jwt: '',\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isEditAvatarOpen: false,\n            isInfoToolTipOpen: false,\n            regSuccess: false,\n            selectedCard: null,\n            cards: [],\n        };\n        this.handleEditAvatarClick = this.handleEditAvatarClick.bind(this);\n        this.handleEditProfileClick = this.handleEditProfileClick.bind(this);\n        this.handleAddPlaceClick = this.handleAddPlaceClick.bind(this);\n        this.handleAuthRegClick = this.handleAuthRegClick.bind(this);\n        this.closeAllPopups = this.closeAllPopups.bind(this);\n        this.handleCardClick = this.handleCardClick.bind(this);\n        this.handleUpdateUser = this.handleUpdateUser.bind(this);\n        this.handleUpdateAvatar = this.handleUpdateAvatar.bind(this);\n        this.handleCardLike = this.handleCardLike.bind(this);\n        this.handleCardDelete = this.handleCardDelete.bind(this);\n        this.handleAddPlace= this.handleAddPlace.bind(this);\n        this.handleLogIn = this.handleLogIn.bind(this);\n        this.handleLogOut = this.handleLogOut.bind(this);\n        this.handleRegister = this.handleRegister.bind(this);\n    }\n\n    componentDidMount() {\n        // Check if user has jwt token\n        const jwt = localStorage.getItem('jwt');\n\n        if (jwt) {\n            this.setState({ jwt: jwt });\n            auth.getUser(jwt).then((res) => {\n                if (res) {\n                    console.log(res);\n                    this.setState({ \n                        isLoggedIn: true,\n                        userEmail: res.data.email,\n                        currentUser: res.data,\n                    });\n                }\n            }).then(() => {\n                this.props.history.push('/');\n            }).catch((err) => { \n                console.log(err) \n            });\n        }   \n            //  // Get user info for profile section\n            // api.getUserInfo(jwt).then((res) => { \n            //     this.setState({ currentUser: res }); \n            // }).catch((err) => { \n            //     console.log(err) \n            // });\n            \n            // Get initial cards\n            api.getInitialCards(jwt).then((res) => { \n                if (res) {\n                    this.setState({ cards: res});\n                }\n            }).catch((err) => { \n                console.log(err) \n            });\n    }\n\n    // componentDidUpdate() {\n    //     const jwt = localStorage.getItem('jwt');\n    //     // Get user info for profile section\n    //     api.getUserInfo(jwt).then((res) => { \n    //         this.setState({ currentUser: res}); \n    //     }).catch((err) => { \n    //         console.log(err) \n    //     });    \n    //     // Get initial cards\n    //     api.getInitialCards(jwt).then((res) => { \n    //         this.setState({ cards: res}); \n    //     }).catch((err) => { \n    //         console.log(err) \n    //     });\n    // }\n\n    handleLogIn(email, password) {\n        auth.authorize(email, password).then((res) => {\n            console.log(res);\n            if (res) {\n                this.setState({ isLoggedIn: true, userEmail: email }, \n                    () => this.props.history.push('/'));\n            } else {\n                this.handleAuthRegClick(false);\n            }\n        }).catch((err) => { \n            console.log(err) \n        });\n    }\n\n    handleRegister(email, password) {\n        auth.register(email, password).then((res) => {\n            if (res) {\n                console.log(res);\n                this.handleAuthRegClick(true);\n                this.props.history.push('/signin');\n            } else {\n                this.handleAuthRegClick(false);\n            }\n        }).catch((err) => { \n            this.handleAuthRegClick(false)\n            console.log(err) \n        });\n    }\n\n    handleLogOut() {\n        localStorage.removeItem('jwt');\n        this.setState({ isLoggedIn: false, email: null });\n    }\n\n    handleEditAvatarClick() {\n        this.setState({ isEditAvatarOpen: true });\n    }\n\n    handleEditProfileClick() {\n        this.setState({ isEditProfileOpen: true });\n    }\n\n    handleAddPlaceClick() {\n        this.setState({ isAddPlaceOpen: true });\n    }\n\n    handleAuthRegClick(result) {\n        this.setState({\n            regSuccess: result,\n            isInfoToolTipOpen: true\n        });\n    }\n\n    closeAllPopups() {\n        this.setState({\n            isEditAvatarOpen: false,\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isInfoToolTipOpen: false,\n            selectedCard: null\n        });\n    }\n\n    handleCardClick(card) {\n        this.setState({ selectedCard: card });\n    }\n\n    handleUpdateUser(newInfo) {\n        api.patchUserInfo({...newInfo, token: this.state.api })\n            .then((res) => { this.setState({ currentUser: res }, this.closeAllPopups())})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleUpdateAvatar(avatar) {\n        api.patchUserPic(avatar)\n            .then((res) => { this.setState({ currentUser: res }, this.closeAllPopups())})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n        api.likeCard(card, isLiked)\n            .then((res) => {\n                const newCards = this.state.cards.map((c) => c._id === card._id ? res : c);\n                this.setState({ cards: newCards });\n            })\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(() => {\n                const newCards = this.state.cards.filter((c) => c._id !== card._id);\n                this.setState({ cards: newCards });\n            }).catch((err) => { \n                console.log(err) \n            });\n    }\n\n    handleAddPlace(card) {\n        api.addNewCard(card)\n            .then((res) => {\n                const newCards = [...this.state.cards, res];\n                this.setState({ cards: newCards }, this.closeAllPopups());\n            }).catch((err) => { \n                console.log(err) \n            });\n        \n    }\n\n    render() {\n        return (\n            <CurrentUserContext.Provider value={this.state.currentUser}>\n                <Switch>\n                    <ProtectedRoute exact path=\"/\" component={Main} loggedIn={this.state.isLoggedIn} userEmail={this.state.userEmail} \n                        onEditProfile={this.handleEditProfileClick} onAddPlace={this.handleAddPlaceClick} onEditAvatar={this.handleEditAvatarClick}\n                        onCardClick={this.handleCardClick} onClose={this.closeAllPopups} cards={this.state.cards} onCardLike={this.handleCardLike} \n                        onCardDelete={this.handleCardDelete} logOut={this.handleLogOut} />\n                    <Route path='/signup'>\n                        <Register register={this.handleRegister} />\n                    </Route>\n                    <Route path='/signin'>\n                        <Login logIn={this.handleLogIn} />\n                    </Route>\n                    <Route path='*'>\n                        <Redirect to=\"/signin\" />\n                    </Route>\n                </Switch>\n                \n                {/* Popup ToolTip for Registration/Login */}\n                <InfoToolTip isOpen={this.state.isInfoToolTipOpen} success={this.state.regSuccess} onClose={this.closeAllPopups} />    \n\n                {/* Popup Edit User Info Form */}\n                <EditProfilePopup isOpen={this.state.isEditProfileOpen} onClose={this.closeAllPopups} onUpdateUser={this.handleUpdateUser} />\n\n                {/* Popup Edit User Pic Form */}\n                <EditAvatarPopup isOpen={this.state.isEditAvatarOpen} onClose={this.closeAllPopups} onUpdateAvatar={this.handleUpdateAvatar} currentUser={this.state.currentUser} />\n\n                {/* Popup Add Form */}\n                <AddPlacePopup isOpen={this.state.isAddPlaceOpen} onClose={this.closeAllPopups} onAddPlace={this.handleAddPlace} />\n\n                {/* Popup Delete Form */}\n                {/* <PopupWithForm name=\"form-delete\" title=\"Are you sure?\" isOpen={null} btnText=\"Yes\" onClose={this.closeAllPopups} /> */}\n\n                {/* Image Popup */}\n                <ImagePopup card={this.state.selectedCard} onClose={this.closeAllPopups} />\n\n            </CurrentUserContext.Provider>\n        );\n    }\n}\n\nexport default withRouter(App);"]},"metadata":{},"sourceType":"module"}