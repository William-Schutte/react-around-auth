{"ast":null,"code":"import _toConsumableArray from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/william/Documents/Programming/Practicum/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Route,Switch,Redirect,withRouter}from'react-router-dom';import Main from'./Main.js';import PopupWithForm from'./PopupWithForm.js';import ImagePopup from'./ImagePopup.js';import api from'../utils/api.js';import CurrentUserContext from'../contexts/CurrentUserContext.js';import EditProfilePopup from'./EditProfilePopup.js';import EditAvatarPopup from'./EditAvatarPopup.js';import AddPlacePopup from'./AddPlacePopup.js';import ProtectedRoute from'./ProtectedRoute';import Register from'./Register';import Login from'./Login';import InfoToolTip from'./InfoToolTip';import*as auth from'../utils/auth.js';var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(){var _this;_classCallCheck(this,App);_this=_super.call(this);_this.state={isLoggedIn:null,userEmail:'',currentUser:{},isEditProfileOpen:false,isAddPlaceOpen:false,isEditAvatarOpen:false,isInfoToolTipOpen:false,regSuccess:false,selectedCard:null,cards:[]};_this.handleEditAvatarClick=_this.handleEditAvatarClick.bind(_assertThisInitialized(_this));_this.handleEditProfileClick=_this.handleEditProfileClick.bind(_assertThisInitialized(_this));_this.handleAddPlaceClick=_this.handleAddPlaceClick.bind(_assertThisInitialized(_this));_this.handleAuthRegClick=_this.handleAuthRegClick.bind(_assertThisInitialized(_this));_this.closeAllPopups=_this.closeAllPopups.bind(_assertThisInitialized(_this));_this.handleCardClick=_this.handleCardClick.bind(_assertThisInitialized(_this));_this.handleUpdateUser=_this.handleUpdateUser.bind(_assertThisInitialized(_this));_this.handleUpdateAvatar=_this.handleUpdateAvatar.bind(_assertThisInitialized(_this));_this.handleCardLike=_this.handleCardLike.bind(_assertThisInitialized(_this));_this.handleCardDelete=_this.handleCardDelete.bind(_assertThisInitialized(_this));_this.handleAddPlace=_this.handleAddPlace.bind(_assertThisInitialized(_this));_this.handleLogIn=_this.handleLogIn.bind(_assertThisInitialized(_this));_this.handleLogOut=_this.handleLogOut.bind(_assertThisInitialized(_this));_this.handleRegister=_this.handleRegister.bind(_assertThisInitialized(_this));return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;// Check if user has jwt token\nvar jwt=localStorage.getItem('jwt');if(jwt){// Get user info for profile section\napi.getUserInfo(jwt).then(function(res){_this2.setState({currentUser:res});}).catch(function(err){console.log(err);});// Get initial cards\napi.getInitialCards(jwt).then(function(res){_this2.setState({cards:res});}).catch(function(err){console.log(err);});auth.getUser(jwt).then(function(res){if(res){console.log(res);_this2.setState({isLoggedIn:true,userEmail:res.data.email});}}).then(function(){_this2.props.history.push('/');}).catch(function(err){console.log(err);});}}// componentDidUpdate() {\n//     // Get user info for profile section\n//     api.getUserInfo().then((res) => { \n//         this.setState({ currentUser: res}); \n//     }).catch((err) => { \n//         console.log(err) \n//     });    \n//     // Get initial cards\n//     api.getInitialCards().then((res) => { \n//         this.setState({ cards: res}); \n//     }).catch((err) => { \n//         console.log(err) \n//     });\n// }\n},{key:\"handleLogIn\",value:function handleLogIn(email,password){var _this3=this;auth.authorize(email,password).then(function(res){console.log(res);if(res){_this3.setState({isLoggedIn:true,userEmail:email},function(){return _this3.props.history.push('/');});}else{_this3.handleAuthRegClick(false);}}).catch(function(err){console.log(err);});}},{key:\"handleRegister\",value:function handleRegister(email,password){var _this4=this;auth.register(email,password).then(function(res){if(res){_this4.handleAuthRegClick(true);_this4.props.history.push('/signin');}else{_this4.handleAuthRegClick(false);}}).catch(function(err){_this4.handleAuthRegClick(false);console.log(err);});}},{key:\"handleLogOut\",value:function handleLogOut(){localStorage.removeItem('jwt');this.setState({isLoggedIn:false,email:null});}},{key:\"handleEditAvatarClick\",value:function handleEditAvatarClick(){this.setState({isEditAvatarOpen:true});}},{key:\"handleEditProfileClick\",value:function handleEditProfileClick(){this.setState({isEditProfileOpen:true});}},{key:\"handleAddPlaceClick\",value:function handleAddPlaceClick(){this.setState({isAddPlaceOpen:true});}},{key:\"handleAuthRegClick\",value:function handleAuthRegClick(result){this.setState({regSuccess:result,isInfoToolTipOpen:true});}},{key:\"closeAllPopups\",value:function closeAllPopups(){this.setState({isEditAvatarOpen:false,isEditProfileOpen:false,isAddPlaceOpen:false,isInfoToolTipOpen:false,selectedCard:null});}},{key:\"handleCardClick\",value:function handleCardClick(card){this.setState({selectedCard:card});}},{key:\"handleUpdateUser\",value:function handleUpdateUser(newInfo){var _this5=this;api.patchUserInfo(newInfo).then(function(res){_this5.setState({currentUser:res},_this5.closeAllPopups());}).catch(function(err){console.log(err);});}},{key:\"handleUpdateAvatar\",value:function handleUpdateAvatar(avatar){var _this6=this;api.patchUserPic(avatar).then(function(res){_this6.setState({currentUser:res},_this6.closeAllPopups());}).catch(function(err){console.log(err);});}},{key:\"handleCardLike\",value:function handleCardLike(card){var _this7=this;var isLiked=card.likes.some(function(i){return i._id===_this7.state.currentUser._id;});api.likeCard(card,isLiked).then(function(res){var newCards=_this7.state.cards.map(function(c){return c._id===card._id?res:c;});_this7.setState({cards:newCards});}).catch(function(err){console.log(err);});}},{key:\"handleCardDelete\",value:function handleCardDelete(card){var _this8=this;api.deleteCard(card._id).then(function(){var newCards=_this8.state.cards.filter(function(c){return c._id!==card._id;});_this8.setState({cards:newCards});}).catch(function(err){console.log(err);});}},{key:\"handleAddPlace\",value:function handleAddPlace(card){var _this9=this;api.addNewCard(card).then(function(res){var newCards=[].concat(_toConsumableArray(_this9.state.cards),[res]);_this9.setState({cards:newCards},_this9.closeAllPopups());}).catch(function(err){console.log(err);});}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(CurrentUserContext.Provider,{value:this.state.currentUser},/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(ProtectedRoute,{exact:true,path:\"/\",component:Main,loggedIn:this.state.isLoggedIn,userEmail:this.state.userEmail,onEditProfile:this.handleEditProfileClick,onAddPlace:this.handleAddPlaceClick,onEditAvatar:this.handleEditAvatarClick,onCardClick:this.handleCardClick,onClose:this.closeAllPopups,cards:this.state.cards,onCardLike:this.handleCardLike,onCardDelete:this.handleCardDelete,logOut:this.handleLogOut}),/*#__PURE__*/React.createElement(Route,{path:\"/signup\"},/*#__PURE__*/React.createElement(Register,{register:this.handleRegister})),/*#__PURE__*/React.createElement(Route,{path:\"/signin\"},/*#__PURE__*/React.createElement(Login,{logIn:this.handleLogIn})),/*#__PURE__*/React.createElement(Route,{path:\"*\"},/*#__PURE__*/React.createElement(Redirect,{to:\"/signin\"}))),/*#__PURE__*/React.createElement(InfoToolTip,{isOpen:this.state.isInfoToolTipOpen,success:this.state.regSuccess,onClose:this.closeAllPopups}),/*#__PURE__*/React.createElement(EditProfilePopup,{isOpen:this.state.isEditProfileOpen,onClose:this.closeAllPopups,onUpdateUser:this.handleUpdateUser}),/*#__PURE__*/React.createElement(EditAvatarPopup,{isOpen:this.state.isEditAvatarOpen,onClose:this.closeAllPopups,onUpdateAvatar:this.handleUpdateAvatar,currentUser:this.state.currentUser}),/*#__PURE__*/React.createElement(AddPlacePopup,{isOpen:this.state.isAddPlaceOpen,onClose:this.closeAllPopups,onAddPlace:this.handleAddPlace}),/*#__PURE__*/React.createElement(ImagePopup,{card:this.state.selectedCard,onClose:this.closeAllPopups}));}}]);return App;}(React.Component);export default withRouter(App);","map":{"version":3,"sources":["/Users/william/Documents/Programming/Practicum/react-around-auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","withRouter","Main","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","Register","Login","InfoToolTip","auth","App","state","isLoggedIn","userEmail","currentUser","isEditProfileOpen","isAddPlaceOpen","isEditAvatarOpen","isInfoToolTipOpen","regSuccess","selectedCard","cards","handleEditAvatarClick","bind","handleEditProfileClick","handleAddPlaceClick","handleAuthRegClick","closeAllPopups","handleCardClick","handleUpdateUser","handleUpdateAvatar","handleCardLike","handleCardDelete","handleAddPlace","handleLogIn","handleLogOut","handleRegister","jwt","localStorage","getItem","getUserInfo","then","res","setState","catch","err","console","log","getInitialCards","getUser","data","email","props","history","push","password","authorize","register","removeItem","result","card","newInfo","patchUserInfo","avatar","patchUserPic","isLiked","likes","some","i","_id","likeCard","newCards","map","c","deleteCard","filter","addNewCard","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport api from '../utils/api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoToolTip from './InfoToolTip'\nimport * as auth from '../utils/auth.js';\n\nclass App extends React.Component {\n    constructor() {\n        super();\n        this.state={\n            isLoggedIn: null,\n            userEmail: '',\n            currentUser: {},\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isEditAvatarOpen: false,\n            isInfoToolTipOpen: false,\n            regSuccess: false,\n            selectedCard: null,\n            cards: [],\n        };\n        this.handleEditAvatarClick = this.handleEditAvatarClick.bind(this);\n        this.handleEditProfileClick = this.handleEditProfileClick.bind(this);\n        this.handleAddPlaceClick = this.handleAddPlaceClick.bind(this);\n        this.handleAuthRegClick = this.handleAuthRegClick.bind(this);\n        this.closeAllPopups = this.closeAllPopups.bind(this);\n        this.handleCardClick = this.handleCardClick.bind(this);\n        this.handleUpdateUser = this.handleUpdateUser.bind(this);\n        this.handleUpdateAvatar = this.handleUpdateAvatar.bind(this);\n        this.handleCardLike = this.handleCardLike.bind(this);\n        this.handleCardDelete = this.handleCardDelete.bind(this);\n        this.handleAddPlace= this.handleAddPlace.bind(this);\n        this.handleLogIn = this.handleLogIn.bind(this);\n        this.handleLogOut = this.handleLogOut.bind(this);\n        this.handleRegister = this.handleRegister.bind(this);\n    }\n\n    componentDidMount() {\n        // Check if user has jwt token\n        const jwt = localStorage.getItem('jwt');\n\n        if (jwt) {\n             // Get user info for profile section\n            api.getUserInfo(jwt).then((res) => { \n                this.setState({ currentUser: res}); \n            }).catch((err) => { \n                console.log(err) \n            });\n            \n            // Get initial cards\n            api.getInitialCards(jwt).then((res) => { \n                this.setState({ cards: res}); \n            }).catch((err) => { \n                console.log(err) \n            });\n\n            auth.getUser(jwt).then((res) => {\n                if (res) {\n                    console.log(res);\n                    this.setState({ \n                        isLoggedIn: true,\n                        userEmail: res.data.email\n                    });\n                }\n            }).then(() => {\n                this.props.history.push('/');\n            }).catch((err) => { \n                console.log(err) \n            });\n        }   \n    }\n\n    // componentDidUpdate() {\n    //     // Get user info for profile section\n    //     api.getUserInfo().then((res) => { \n    //         this.setState({ currentUser: res}); \n    //     }).catch((err) => { \n    //         console.log(err) \n    //     });    \n    //     // Get initial cards\n    //     api.getInitialCards().then((res) => { \n    //         this.setState({ cards: res}); \n    //     }).catch((err) => { \n    //         console.log(err) \n    //     });\n    // }\n\n    handleLogIn(email, password) {\n        auth.authorize(email, password).then((res) => {\n            console.log(res);\n            if (res) {\n                this.setState({ isLoggedIn: true, userEmail: email }, \n                    () => this.props.history.push('/'));\n            } else {\n                this.handleAuthRegClick(false);\n            }\n        }).catch((err) => { \n            console.log(err) \n        });\n    }\n\n    handleRegister(email, password) {\n        auth.register(email, password).then((res) => {\n            if (res) {\n                this.handleAuthRegClick(true);\n                this.props.history.push('/signin');\n            } else {\n                this.handleAuthRegClick(false);\n            }\n        }).catch((err) => { \n            this.handleAuthRegClick(false)\n            console.log(err) \n        });\n    }\n\n    handleLogOut() {\n        localStorage.removeItem('jwt');\n        this.setState({ isLoggedIn: false, email: null });\n    }\n\n    handleEditAvatarClick() {\n        this.setState({ isEditAvatarOpen: true });\n    }\n\n    handleEditProfileClick() {\n        this.setState({ isEditProfileOpen: true });\n    }\n\n    handleAddPlaceClick() {\n        this.setState({ isAddPlaceOpen: true });\n    }\n\n    handleAuthRegClick(result) {\n        this.setState({\n            regSuccess: result,\n            isInfoToolTipOpen: true\n        });\n    }\n\n    closeAllPopups() {\n        this.setState({\n            isEditAvatarOpen: false,\n            isEditProfileOpen: false,\n            isAddPlaceOpen: false,\n            isInfoToolTipOpen: false,\n            selectedCard: null\n        });\n    }\n\n    handleCardClick(card) {\n        this.setState({ selectedCard: card });\n    }\n\n    handleUpdateUser(newInfo) {\n        api.patchUserInfo(newInfo)\n            .then((res) => { this.setState({ currentUser: res }, this.closeAllPopups())})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleUpdateAvatar(avatar) {\n        api.patchUserPic(avatar)\n            .then((res) => { this.setState({ currentUser: res }, this.closeAllPopups())})\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === this.state.currentUser._id);\n        api.likeCard(card, isLiked)\n            .then((res) => {\n                const newCards = this.state.cards.map((c) => c._id === card._id ? res : c);\n                this.setState({ cards: newCards });\n            })\n            .catch((err) => { console.log(err) });\n    }\n\n    handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(() => {\n                const newCards = this.state.cards.filter((c) => c._id !== card._id);\n                this.setState({ cards: newCards });\n            }).catch((err) => { \n                console.log(err) \n            });\n    }\n\n    handleAddPlace(card) {\n        api.addNewCard(card)\n            .then((res) => {\n                const newCards = [...this.state.cards, res];\n                this.setState({ cards: newCards }, this.closeAllPopups());\n            }).catch((err) => { \n                console.log(err) \n            });\n        \n    }\n\n    render() {\n        return (\n            <CurrentUserContext.Provider value={this.state.currentUser}>\n                <Switch>\n                    <ProtectedRoute exact path=\"/\" component={Main} loggedIn={this.state.isLoggedIn} userEmail={this.state.userEmail} \n                        onEditProfile={this.handleEditProfileClick} onAddPlace={this.handleAddPlaceClick} onEditAvatar={this.handleEditAvatarClick}\n                        onCardClick={this.handleCardClick} onClose={this.closeAllPopups} cards={this.state.cards} onCardLike={this.handleCardLike} \n                        onCardDelete={this.handleCardDelete} logOut={this.handleLogOut} />\n                    <Route path='/signup'>\n                        <Register register={this.handleRegister} />\n                    </Route>\n                    <Route path='/signin'>\n                        <Login logIn={this.handleLogIn} />\n                    </Route>\n                    <Route path='*'>\n                        <Redirect to=\"/signin\" />\n                    </Route>\n                </Switch>\n                \n                {/* Popup ToolTip for Registration/Login */}\n                <InfoToolTip isOpen={this.state.isInfoToolTipOpen} success={this.state.regSuccess} onClose={this.closeAllPopups} />    \n\n                {/* Popup Edit User Info Form */}\n                <EditProfilePopup isOpen={this.state.isEditProfileOpen} onClose={this.closeAllPopups} onUpdateUser={this.handleUpdateUser} />\n\n                {/* Popup Edit User Pic Form */}\n                <EditAvatarPopup isOpen={this.state.isEditAvatarOpen} onClose={this.closeAllPopups} onUpdateAvatar={this.handleUpdateAvatar} currentUser={this.state.currentUser} />\n\n                {/* Popup Add Form */}\n                <AddPlacePopup isOpen={this.state.isAddPlaceOpen} onClose={this.closeAllPopups} onAddPlace={this.handleAddPlace} />\n\n                {/* Popup Delete Form */}\n                {/* <PopupWithForm name=\"form-delete\" title=\"Are you sure?\" isOpen={null} btnText=\"Yes\" onClose={this.closeAllPopups} /> */}\n\n                {/* Image Popup */}\n                <ImagePopup card={this.state.selectedCard} onClose={this.closeAllPopups} />\n\n            </CurrentUserContext.Provider>\n        );\n    }\n}\n\nexport default withRouter(App);"]},"metadata":{},"sourceType":"module"}